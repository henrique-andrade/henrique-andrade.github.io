<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Obtendo dados do Banco Central de forma automática</title>
  <link rel="stylesheet" type="text/css" href="http://henrique-andrade.github.io/stylesheets/artigos.css">
  <!-- <link href="http://guilhermemuller.com.br/css/cursos/html_basico/1/inserindo-css.css" rel="stylesheet"> -->

</head>

<body>
    
<h1 id="obtendo-dados-do-banco-central-de-forma-automática"><a name="obtendo-dados-do-banco-central-de-forma-automática" href="#obtendo-dados-do-banco-central-de-forma-automática"></a>Obtendo dados do Banco Central de forma automática</h1><p>Henrique Andrade (2015)</p><p class="toc" style="undefined"></p><ul>
<li><ul>
<li><span class="title">
<a href="#1.-introdução" title="1. Introdução">1. Introdução</a>
</span>
<!--span class="number">
0
</span-->
</li>
<li><span class="title">
<a href="#2.-metodologia" title="2. Metodologia">2. Metodologia</a>
</span>
<!--span class="number">
1
</span-->
<ul>
<li><span class="title">
<a href="#2.1-o-sistema-gerenciador-de-séries-temporais-(sgs)-do-bacen" title="2.1 O Sistema Gerenciador de Séries Temporais (SGS) do Bacen">2.1 O Sistema Gerenciador de Séries Temporais (SGS) do Bacen</a>
</span>
<!--span class="number">
2
</span-->
</li>
<li><span class="title">
<a href="#2.2-linguagem-python" title="2.2 Linguagem Python">2.2 Linguagem Python</a>
</span>
<!--span class="number">
3
</span-->
</li>
<li><span class="title">
<a href="#2.3-descrição-do-algoritmo" title="2.3 Descrição do algoritmo">2.3 Descrição do algoritmo</a>
</span>
<!--span class="number">
4
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#3.-conclusão" title="3. Conclusão">3. Conclusão</a>
</span>
<!--span class="number">
5
</span-->
</li>
<li><span class="title">
<a href="#referências" title="Referências">Referências</a>
</span>
<!--span class="number">
6
</span-->
</li>
<li><span class="title">
<a href="#apêndice:-código-completo" title="Apêndice: código completo">Apêndice: código completo</a>
</span>
<!--span class="number">
7
</span-->
</li>
</ul>
</li>

</ul>
<p></p><blockquote>
<p><strong>Resumo</strong><br>Este artigo tem como objetivo descrever um algoritmo para obtenção e estruturação de dados de séries temporais do Banco Central Brasil de forma automática via linguagem Python.</p>
<p>Classificação JEL: C8, C81, C88</p>
</blockquote><h2 id="1.-introdução"><a name="1.-introdução" href="#1.-introdução"></a>1. Introdução</h2><p>A obtenção e/ou atualização de dados constitui um dos primeiros desafios para a elaboração de estudos empíricos em econometria. São vários os fatores que contribuem para dificultar esse processo, com destaque para a existência de múltiplas fontes de informações e a falta de homogeneização na tabulação e na forma de armazenamento dos dados.</p><p>Além dessa dificuldade inicial, em um contexto menos acadêmico e mais comercial, é comum que exista a necessidade de “atualizar” os modelos estimados com informações provenientes da divulgação de novas observações das séries utilizadas. Assim, a frequência da manutenção do modelo (via reestimação de parâmetros ou via inclusão dos novos valores observados) dependerá em grande parte da periodicidade dos dados.</p><p>Quando trata-se de dados de menor frequência, como os anuais, pode ser possível ignorar essa dificuldade, uma vez que seria necessária a manutenção uma única vez no ano inteiro. Esse quadro se altera de forma importante a medida que séries de maior frequência são utilizadas. Um caso ilustrativo seria um modelo para previsão da taxa de câmbio com base em informações diárias. Nesse caso seria necessário obter e compilar os dados necessários diariamente.</p><p>Uma forma de minimizar a questão das múltiplas fontes de informações, da falta de homogeneização na tabulação e da forma de armazenamento dos dados seria a utilização de um repositório que centralizasse os dados e os disponibilizasse de forma homogênia. Isso de fato já foi implementado por várias instituições nacionais, com destaque para o Ipeadata, mantido pelo Instituto de Pesquisa Econômica Aplicada (Ipea), e para o Sistema Gerenciador de Séries Temporais (SGS), mantido pelo Banco Central do Brasil (Bacen).</p><p>No presente artigo será tratada a questão da obtenção e da atualização dos dados econômicos e/ou financeiros de forma automatizada. Para tanto, foi escolhido o SGS como fonte das informações. Essa escolha deveu-se pelo fato dessa base ser abrangente, gratuita e possuir um mecanismo que permite sua utilização em contextos de automatização de processos.</p><p>De forma mais específica, será apresentado um algoritmo onde os usuários do SGS precisarão inserir informações mínimas para obter e atualizar os dados necessários em suas pesquisas, reduzindo potencialmente o tempo necessário para a obtenção das estimações. Importante salientar que o mesmo foi escrito na linguagem de programação Python e que todas as ferramentas utilizadas são baseadas em tecnologias gratuitas e com código livre.</p><p>Além desta introdução, o artigo possui mais uma seção e a conclusão. Na segunda seção é apresentada a metodologia utilizada, explicitando o funcionamento do SGS, a razão pela escolha do Python, as ferramentas utilizadas e a construção do algoritmo. Por fim, conclui-se o trabalho.</p><h2 id="2.-metodologia"><a name="2.-metodologia" href="#2.-metodologia"></a>2. Metodologia</h2><h3 id="2.1-o-sistema-gerenciador-de-séries-temporais-(sgs)-do-bacen"><a name="2.1-o-sistema-gerenciador-de-séries-temporais-(sgs)-do-bacen" href="#2.1-o-sistema-gerenciador-de-séries-temporais-(sgs)-do-bacen"></a>2.1 O Sistema Gerenciador de Séries Temporais (SGS) do Bacen</h3><p>O Sistema Gerenciador de Séries Temporais do Bacen (SGS) consiste em um repositório de dados econômico-financeiros de diversas fontes que podem ser consultados livremente. De acordo com o Bacen (2015), as séries podem ser consultadas individualmente, em grupos ou listas personalizadas ou de forma automática. O SGS utiliza a tecnologia de <em>web services</em> para a disponibilização de serviços de consulta automático. Maiores detalhes sobre <em>web services</em> podem ser encontrados em Cerami (2002).</p><p>Entre os vários serviços disponibilizados, o <code>getValoresSeriesXML</code> é o que fornece os valores de uma ou mais séries dentro de um determinado período. Por esse motivo é o mais adequado para o salvamento de múltiplas séries de tempo. Para utilizá-lo é necessário determinar os seguintes parâmetros:</p><ul>
<li><code>codigosSeries</code>: lista dos códigos das séries;</li><li><code>dataInicio</code>: string contendo a data inicial (no formato dd/mm/aaaa);</li><li><code>dataFim</code>: string contendo a data final (no formato dd/mm/aaaa).</li></ul><p>O serviço <code>getValoresSeriesXML</code> irá retornar um arquivo escrito na linguagem XML com as informações solicitadas. XML (sigla para <em>eXtensible Markup Language</em>) é uma linguagem de marcação (ou seja, que descreve a estrura de documentos ou dados) que utiliza etiquetas (<em>tags</em>) para rotular, categorizar e organizar informações de forma específica (DYKES; TITTEL, 2005).</p><p>Apesar do serviço <code>getValoresSeriesXML</code> fornecer o arquivo XML que pode ser acessado diretamente via editores de texto, é possível convertê-lo para outro formato que facilite sua utilização em planilhas eletrônicas.</p><h3 id="2.2-linguagem-python"><a name="2.2-linguagem-python" href="#2.2-linguagem-python"></a>2.2 Linguagem Python</h3><p>Dada a possibilidade de obter os dados do SGS e de utilizá-los em análises estatísticas ou econométricas surgem duas questões fundamentais: (1) como utilizar os <em>web services</em> do Bacen na prática e, (2) como converter o XML obtido em um arquivo que possa ser acessado via programas de planilhas eletrônicas. Para tratar essas questões é necessária a utilização de programação de computadores e, como consequência, a utilização de uma linguagem adequada para estas tarefas. A escolha da linguagem Python (ROSSUM, 1995) foi baseada na sua robustez e facilidade de uso.</p><p>De fato, a linguagem Python, conforme observan, Sande e Sande (2009) foi criada tendo como um de seus objetivos a facilidade de utilização. Além disso, o Python é gratuito e tem código fonte aberto, o que permitiu o desenvolvimento de vários módulos (ou suplementos) capazes de extender suas capacidades. Entra estes módulos, o contexto deste artigo, destacam-se os capazes de promover a interação entre os computadores e as informações disponíveis na internet e os capazes de estruturar dados. Esses módulos serão apresentados na próxima seção.</p><h3 id="2.3-descrição-do-algoritmo"><a name="2.3-descrição-do-algoritmo" href="#2.3-descrição-do-algoritmo"></a>2.3 Descrição do algoritmo</h3><p>Foge do escopo deste trabalho a descrição técnica dos módulos utilizados, sendo recomendada a leitura das respectivas documentações caso seja desejado um maior aprofundamento sobre seu funcionamento. Dito isto, os próximos parágrafos descrevem a construção do algoritmo para obtenção e estruturação dos dados do SGS.</p><p>O código pode ser dividido em duas partes, sendo a primeira a obtenção dos dados e em seguida a conversão destes para o formato <code>xlsx</code>. Para a primeira parte são utilizados os módulos Suds (ORTEL 2010) e The ElementTree XML API (LUNDH, 2008) e para a segunda o Pandas (McKINNEY, 2010). Para utilizá-los são necessários os seguintes comandos:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>import xml.etree.ElementTree as ET
from suds.client import Client
import pandas as pd
</code></pre>"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET
<span class="hljs-keyword">from</span> suds.client <span class="hljs-keyword">import</span> Client
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
</code></pre><p>Como ilustração, serão utilizadas três séries mensais entre 1970 e 2015:</p><ul>
<li>Índice geral de preços do mercado (IGP-M) (código SGS: 189)</li><li>Índice nacional de preços ao consumidor-amplo (IPCA) (código SGS: 433)</li><li>PIB acumulado dos últimos 12 meses - Em US$ milhões (código SGS: 4192)</li></ul><p>Em termos de código isso pode ser representado da seguinte forma:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>codigosSeries = [189, 433, 4192]
dataInicio = &quot;01/01/1970&quot;
dataFim = &quot;01/10/2015&quot;
</code></pre>">codigosSeries = [<span class="hljs-number">189</span>, <span class="hljs-number">433</span>, <span class="hljs-number">4192</span>]
dataInicio = <span class="hljs-string">"01/01/1970"</span>
dataFim = <span class="hljs-string">"01/10/2015"</span>
</code></pre><p>A variável <code>localSalvamento</code> informará em qual diretório do computador os dados serão armazenados. Caso o usuário deseje acrescentar ou alterar as séries ou os períodos bastará modificar os valores de <code>codigosSeries</code>, <code>dataInicio</code> e/ou <code>dataFim</code>.</p><p>Em seguida são criadas três variáveis, <code>dadosTemp</code> e <code>datasTemp</code>, para armazenar de forma temporária os valores obtidos no SGS, e <code>dadosBCB</code>, para armazenar de forma definitiva todas as informações. O <code>dadosBCB</code> representa uma estrutura de dados chamada de dicionário no Python e permite a conversão posterior dos dados, via Pandas, em uma planilha eletrônica. O código para a construção das variáveis é:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>dadosTemp = []
datasTemp = []
dadosBCB = {}
</code></pre>">dadosTemp = []
datasTemp = []
dadosBCB = {}
</code></pre><p>Em seguida executa-se um ciclo de comandos (<em>loop</em>) que irá realizar uma varredura no arquivo <code>resultadoXML</code> em busca das informações solicitadas:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>for child in root:
</code></pre>"><span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> root:
</code></pre><p>O último passo a ser dado consiste na conversão da variável <code>dadosBCB</code> em um arquivo no formato <code>xlsx</code>. Para tanto será utilizado o módulo Pandas:</p><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>dadosBCB_df = pd.DataFrame(dadosBCB).astype(float)
</code></pre>">dadosBCB_df = pd.DataFrame(dadosBCB).astype(float)
</code></pre><p>O primeiro comando converte as informações obtidas de texto para números e o segundo cria e salva o arquivo <code>xlsx</code> na pasta definida na variável <code>localSalvamento</code> com o nome <code>AutoBCB.xlsx</code>. O arquivo <code>AutoBCB.xlsx</code> poderá agora ser utilizado em qualquer programa de planilha eletrônica (como o Excel ou o LibreOffice).</p><h2 id="3.-conclusão"><a name="3.-conclusão" href="#3.-conclusão"></a>3. Conclusão</h2><p>Xoxoxoxoxo xo xoxoxox xoxoxoxoxo xoxo xoxoxoxox xoxoxox xoxoxoxo xo xoxoxox xoxoxoxoxo xoxo xoxoxoxox xoxoxox xoxoxoxo xo xoxoxox xoxoxoxoxo xoxo xoxoxoxox xoxoxox xoxoxoxo xo xoxoxox xoxoxoxoxo xoxo xoxoxoxox xoxoxox xoxoxoxo.</p><h2 id="referências"><a name="referências" href="#referências"></a>Referências</h2><p>BANCO CENTRAL DO BRASIL. O Sistema Gerenciador de Séries Temporais. 2015. Disponível em <a href="&lt;http://www4.bcb.gov.br/pec/series/port/aviso.asp">&lt;http://www4.bcb.gov.br/pec/series/port/aviso.asp</a>&gt;.</p><p>CERAMI, Ethan. Web services essentials: Distributed Applications with XML-RPC, SOAP, UDDI &amp; WSDL. O’Reilly, 2002.</p><p>DYKES, Lucinda; TITTEL, Ed. XML For Dummies. 4. ed. Hoboken: Wiley, 2005.</p><p>LUNDH, Fredrik. The elementtree.ElementTree Module. 2008. (disponível em <a href="&lt;http://effbot.org/zone/pythondoc-elementtree-ElementTree.htm">&lt;http://effbot.org/zone/pythondoc-elementtree-ElementTree.htm</a>&gt;)</p><p>McKINNEY, Wes. Data Structures for Statistical Computing in Python. Proceedings of the 9th Python in Science Conference, 51-56 (2010) (disponível em <a href="&lt;http://conference.scipy.org/proceedings/scipy2010/mckinney.html">&lt;http://conference.scipy.org/proceedings/scipy2010/mckinney.html</a>&gt;)</p><p>ORTEL, Jeff.  Suds: Lightweight SOAP client. 2010. (disponível em <a href="&lt;https://fedorahosted.org/suds/">&lt;https://fedorahosted.org/suds/</a>&gt;)</p><p>ROSSUM, Guido van. Python tutorial. Technical Report CS-R9526, Centrum voor Wiskunde en Informatica, 1995.</p><p>SANDE, Warren.; SANDE, Carter. Hello World! Computer Programming for Kids and Other Beginners. 1. ed. Greenwich: Manning, 2009.</p><h2 id="apêndice:-código-completo"><a name="apêndice:-código-completo" href="#apêndice:-código-completo"></a>Apêndice: código completo</h2><pre class="python hljs"><code class="python" data-origin="<pre><code class=&quot;python&quot;>import xml.etree.ElementTree as ET
from suds.client import Client
import pandas as pd

dadosBCB_df = pd.DataFrame(dadosBCB).astype(float)
dadosBCB_df.to_excel(localSalvamento + &quot;AutoBCB.xlsx&quot;, sheet_name=&quot;Dados BCB&quot;)
</code></pre>"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET
<span class="hljs-keyword">from</span> suds.client <span class="hljs-keyword">import</span> Client
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

dadosBCB_df = pd.DataFrame(dadosBCB).astype(float)
dadosBCB_df.to_excel(localSalvamento + <span class="hljs-string">"AutoBCB.xlsx"</span>, sheet_name=<span class="hljs-string">"Dados BCB"</span>)
</code></pre>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
